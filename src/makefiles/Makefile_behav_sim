TESTBENCH=tb_matmul

TESTNAME=default

SRC_VERILOG=../../src/rtl
SRC_VERIF=../../src/verif
RTL_FOLDER=$(SRC_VERILOG)
TB_FOLDER=$(SRC_VERIF)/testbench

DEBUG=1
VCS=1

#Build up a list of verilog define statements to be used by vcs

VERILOG_DEFINES:= 
ifeq ($(DEBUG), 1)
		VERILOG_DEFINES := $(VERILOG_DEFINES)+DEBUG=1
endif
ifeq ($(VCS), 1)
		VERILOG_DEFINES := $(VERILOG_DEFINES)+VCS=1
endif

.DEFAULT_GOAL := vcs

# Move all the verilog files from the source directory over to this simulation directory
link_src:
	ln -s $(RTL_FOLDER) .
	ln -s $(TB_FOLDER) .
	ln -s $(SRC_VERIF)/include/$(TESTBENCH).include .


# A new option has been added here. Take a closer look at -cm. Look it up!
vcs:$(TESTBENCH).include
	vcs -f $(TESTBENCH).include +v2k -R +lint=all -sverilog -full64 \
		-timescale=1ns/10ps -debug_access+all -debug_region+cell+encrypt \
		-debug_access -l $(TESTBENCH).log +define+$(VERILOG_DEFINES) +testname=$(TESTNAME) \
		-cm fsm+line+assert \
		-lca -kdb
		# simv 

wipe: clean
	rm -rf $(TESTBENCH).include
	rm -rf alib-52
	rm -rf simv.daidir
	rm -rf DVEfiles
	rm -rf *.log
	rm -rf *.vpd
	rm -rf ucli.key
	rm -rf default.svf
	rm -rf simv
	rm -rf *.sv *.v *.svh
	rm -rf csrc
	rm -rf novas*
	rm -rf verdi_config_file
	rm -rf verdiLog
	rm -rf *.fsdb
	rm -rf rtl
	rm -rf testbench

clean:
	rm -rf DVEfiles
	rm -rf *.log
	rm -rf *.vpd
	rm -rf ucli.key
	rm -rf alib-52
	rm -rf $(TESTBENCH)
	rm -rf simv.daidir
	rm -rf csrc
	rm -rf simv
	rm -rf novas*
	rm -rf verdi_config_file
	rm -rf verdiLog
	rm -rf *.fsdb
	rm -rf *.vdb
	rm -rf vdCovLog
	rm -rf .fsm.sch.verilog.xml
	rm -rf vdCov.conf
	rm -rf dut_log/*